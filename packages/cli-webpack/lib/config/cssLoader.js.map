{"version":3,"sources":["../../src/config/cssLoader.js"],"names":["webpackConfig","isProd","sourceMap","filename","chunkFilename","cssPublicPath","cssnanoOptions","preset","mergeLonghand","cssDeclarationSorter","map","inline","createCSSRule","lang","test","loader","options","baseRule","module","rule","use","extractLoader","publicPath","cssLoaderOptions","importLoaders","plugins","require","Object","assign","indentedSyntax","plugin","MiniCssExtractPlugin"],"mappings":";;;;;;;;;AAAA;;AAEA;;;;;;;;;;eAUe,kBAACA,aAAD,QAAkF;AAAA,MAAhEC,MAAgE,QAAhEA,MAAgE;AAAA,MAAxDC,SAAwD,QAAxDA,SAAwD;AAAA,MAA7CC,QAA6C,QAA7CA,QAA6C;AAAA,MAAnCC,aAAmC,QAAnCA,aAAmC;AAAA,MAApBC,aAAoB,QAApBA,aAAoB;AAC/F,MAAMC,cAAc,GAAG;AACrBC,IAAAA,MAAM,EAAE,CACN,SADM,EAEN;AACEC,MAAAA,aAAa,EAAE,KADjB;AAEEC,MAAAA,oBAAoB,EAAE;AAFxB,KAFM;AADa,GAAvB;;AASA,MAAIP,SAAJ,EAAe;AACbI,IAAAA,cAAc,CAACI,GAAf,GAAqB;AAAEC,MAAAA,MAAM,EAAE;AAAV,KAArB;AACD;;AAED,WAASC,aAAT,CAAuBC,IAAvB,EAA6BC,IAA7B,EAAmCC,MAAnC,EAA2CC,OAA3C,EAAoD;AAClD,QAAMC,QAAQ,GAAGjB,aAAa,CAACkB,MAAd,CAAqBC,IAArB,CAA0BN,IAA1B,EAAgCC,IAAhC,CAAqCA,IAArC,CAAjB;;AAEA,QAAIb,MAAJ,EAAY;AACVgB,MAAAA,QAAQ,CAACG,GAAT,CAAa,oBAAb,EAAmCL,MAAnC,CAA0CM,4BAA1C,EAAyDL,OAAzD,CAAiE;AAC/DM,QAAAA,UAAU,EAAEjB;AADmD,OAAjE;AAGD,KAJD,MAIO;AACLY,MAAAA,QAAQ,CAACG,GAAT,CAAa,cAAb,EAA6BL,MAA7B,CAAoC,cAApC;AACD;;AAED,QAAMQ,gBAAgB,GAAG;AACvBrB,MAAAA,SAAS,EAATA,SADuB;AAEvBsB,MAAAA,aAAa,EAAE,KAAKvB,MAAM,GAAG,CAAH,GAAO,CAAlB,CAFQ,CAEa;;AAFb,KAAzB;AAKAgB,IAAAA,QAAQ,CAACG,GAAT,CAAa,YAAb,EAA2BL,MAA3B,CAAkC,YAAlC,EAAgDC,OAAhD,CAAwDO,gBAAxD;;AAEA,QAAItB,MAAJ,EAAY;AACVgB,MAAAA,QAAQ,CACLG,GADH,CACO,SADP,EAEGL,MAFH,CAEU,gBAFV,EAGGC,OAHH,CAGW;AACPd,QAAAA,SAAS,EAATA,SADO;AAEPuB,QAAAA,OAAO,EAAE,CAACC,OAAO,CAAC,SAAD,CAAP,CAAmBpB,cAAnB,CAAD;AAFF,OAHX;AAOD;;AAEDW,IAAAA,QAAQ,CAACG,GAAT,CAAa,gBAAb,EAA+BL,MAA/B,CAAsC,gBAAtC,EAAwDC,OAAxD,CAAgE;AAAEd,MAAAA,SAAS,EAATA;AAAF,KAAhE;;AAEA,QAAIa,MAAJ,EAAY;AACVE,MAAAA,QAAQ,CAACG,GAAT,CAAaL,MAAb,EAAqBA,MAArB,CAA4BA,MAA5B,EAAoCC,OAApC,CAA4CW,MAAM,CAACC,MAAP,CAAc;AAAE1B,QAAAA,SAAS,EAATA;AAAF,OAAd,EAA6Bc,OAA7B,CAA5C;AACD;AACF;;AAEDJ,EAAAA,aAAa,CAAC,KAAD,EAAQ,QAAR,CAAb;AACAA,EAAAA,aAAa,CAAC,SAAD,EAAY,eAAZ,CAAb;AACAA,EAAAA,aAAa,CAAC,MAAD,EAAS,SAAT,EAAoB,aAApB,CAAb;AACAA,EAAAA,aAAa,CAAC,MAAD,EAAS,SAAT,EAAoB,aAApB,EAAmC;AAAEiB,IAAAA,cAAc,EAAE;AAAlB,GAAnC,CAAb;AACAjB,EAAAA,aAAa,CAAC,MAAD,EAAS,SAAT,EAAoB,aAApB,CAAb;AAEA;;;;AAGA,MAAIX,MAAJ,EAAY;AACV;AACAD,IAAAA,aAAa,CAAC8B,MAAd,CAAqB,aAArB,EAAoCV,GAApC,CAAwCW,gCAAxC,EAA8D,CAAC;AAAE5B,MAAAA,QAAQ,EAARA,QAAF;AAAYC,MAAAA,aAAa,EAAbA;AAAZ,KAAD,CAA9D,EAFU,CAIV;;AACAJ,IAAAA,aAAa,CAAC8B,MAAd,CAAqB,cAArB,EAAqCV,GAArC,CAAyCM,OAAO,CAAC,qCAAD,CAAhD,EAAyF,CACvF;AACExB,MAAAA,SAAS,EAAEA,SADb;AAEEI,MAAAA,cAAc,EAAdA;AAFF,KADuF,CAAzF;AAMD;AACF,C","sourcesContent":["import MiniCssExtractPlugin, { loader as extractLoader } from 'mini-css-extract-plugin';\r\n\r\n/**\r\n * @param {*} webpackConfig webpack-chain配置对象\r\n * @param {*} param\r\n * themes @uyun/less-plugin-themes 主题数据，不传则不启用插件\r\n * extract 是否分离css为单独文件\r\n * sourceMap 是否生成sourceMap\r\n * filename 生成文件路径\r\n * chunkFilename  生成文件路径\r\n * publicPath 资源文件路径publicPath，以output文件夹为根路径\r\n */\r\nexport default (webpackConfig, { isProd, sourceMap, filename, chunkFilename, cssPublicPath }) => {\r\n  const cssnanoOptions = {\r\n    preset: [\r\n      'default',\r\n      {\r\n        mergeLonghand: false,\r\n        cssDeclarationSorter: false\r\n      }\r\n    ]\r\n  };\r\n  if (sourceMap) {\r\n    cssnanoOptions.map = { inline: false };\r\n  }\r\n\r\n  function createCSSRule(lang, test, loader, options) {\r\n    const baseRule = webpackConfig.module.rule(lang).test(test);\r\n\r\n    if (isProd) {\r\n      baseRule.use('extract-css-loader').loader(extractLoader).options({\r\n        publicPath: cssPublicPath\r\n      });\r\n    } else {\r\n      baseRule.use('style-loader').loader('style-loader');\r\n    }\r\n\r\n    const cssLoaderOptions = {\r\n      sourceMap,\r\n      importLoaders: 2 + (isProd ? 1 : 0) // stylePostLoader injected by vue-loader\r\n    };\r\n\r\n    baseRule.use('css-loader').loader('css-loader').options(cssLoaderOptions);\r\n\r\n    if (isProd) {\r\n      baseRule\r\n        .use('cssnano')\r\n        .loader('postcss-loader')\r\n        .options({\r\n          sourceMap,\r\n          plugins: [require('cssnano')(cssnanoOptions)]\r\n        });\r\n    }\r\n\r\n    baseRule.use('postcss-loader').loader('postcss-loader').options({ sourceMap });\r\n\r\n    if (loader) {\r\n      baseRule.use(loader).loader(loader).options(Object.assign({ sourceMap }, options));\r\n    }\r\n  }\r\n\r\n  createCSSRule('css', /\\.css$/);\r\n  createCSSRule('postcss', /\\.p(ost)?css$/);\r\n  createCSSRule('scss', /\\.scss$/, 'sass-loader');\r\n  createCSSRule('sass', /\\.sass$/, 'sass-loader', { indentedSyntax: true });\r\n  createCSSRule('less', /\\.less$/, 'less-loader');\r\n\r\n  /**\r\n   * css 压缩\r\n   * */\r\n  if (isProd) {\r\n    // inject CSS extraction plugin\r\n    webpackConfig.plugin('extract-css').use(MiniCssExtractPlugin, [{ filename, chunkFilename }]);\r\n\r\n    // minify extracted CSS\r\n    webpackConfig.plugin('optimize-css').use(require('@intervolga/optimize-cssnano-plugin'), [\r\n      {\r\n        sourceMap: sourceMap,\r\n        cssnanoOptions\r\n      }\r\n    ]);\r\n  }\r\n};\r\n"],"file":"cssLoader.js"}