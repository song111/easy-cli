{"version":3,"sources":["../../src/config/dev.js"],"names":["api","mode","argv","port","chainWebpack","webpackConfig","easyConfig","baseURL","proxy","url","ipv4","map","join","isProd","extract","sourceMap","filename","chunkFilename","publicPath","watch","devtool","output","devServer","host","hot","contentBase","resolve","watchContentBase","disableHostCheck","clientLogLevel","compress","overlay","quiet","inline","when","config","oProxy","get","push","before","app","server","regexp","RegExp","use","req","res","next","test","path","redirect","replace","plugin","HotModuleReplacementPlugin","FriendlyErrorsPlugin","compilationSuccessInfo","messages","notes","onErrors","severity","errors","setImmediate","logger","log","chalk","bgBlue","black","bgWhite"],"mappings":"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","sourcesContent":["import { HotModuleReplacementPlugin } from 'webpack';\r\nimport FriendlyErrorsPlugin from 'friendly-errors-webpack-plugin';\r\nimport { getIPv4URL, logger, chalk, formatProxy, detectPort } from '@chrissong/cli-utils';\r\nimport cssLoader from './cssLoader';\r\n\r\n/**\r\n * webpack通用配置\r\n * @param{Object} api api实例\r\n */\r\n\r\nexport default async (api) => {\r\n  if (api.mode !== 'development') return;\r\n\r\n  const port = await detectPort(api.argv.port);\r\n\r\n  api.chainWebpack((webpackConfig) => {\r\n    const { baseURL, proxy } = api.easyConfig;\r\n\r\n    const url = `http://localhost:${port}/${baseURL}`;\r\n    const ipv4 = getIPv4URL(port, baseURL)\r\n      .map((url) => `    ${url}`)\r\n      .join('\\n');\r\n\r\n    // 加载样式\r\n    cssLoader(webpackConfig, {\r\n      isProd: false,\r\n      extract: false,\r\n      sourceMap: true,\r\n      filename: 'static/css/[name].css',\r\n      chunkFilename: 'static/css/[id].css',\r\n      publicPath: '../../'\r\n    });\r\n\r\n    /**\r\n     * 配置模式与devtool\r\n     */\r\n    webpackConfig\r\n      .watch(true)\r\n      .mode('development')\r\n      .devtool('cheap-module-eval-source-map')\r\n      .output.filename('static/js/[name].js');\r\n\r\n    /**\r\n     * devServer\r\n     */\r\n    webpackConfig.devServer\r\n      // 热更新ws地址与location.host保持一致\r\n      .host('0.0.0.0')\r\n      .port(port)\r\n      .hot(true)\r\n      .contentBase(api.resolve('public'))\r\n      .watchContentBase(true) // 检测public下文件变动\r\n      .publicPath('')\r\n      .disableHostCheck(true)\r\n      .clientLogLevel('warning')\r\n      .compress(true)\r\n      .overlay(true)\r\n      .quiet(true)\r\n      .inline(true)\r\n      .when(proxy, (config) => {\r\n        let oProxy = config.get('proxy');\r\n        if (!oProxy) oProxy = [];\r\n        oProxy = formatProxy(oProxy);\r\n        oProxy.push(...formatProxy(proxy));\r\n        config.proxy(oProxy);\r\n      })\r\n      .when(baseURL, (config) => {\r\n        // 支持baseURL\r\n        config.before((app, server) => {\r\n          const regexp = new RegExp(`^/${baseURL}/?`);\r\n          app.use((req, res, next) => {\r\n            if (regexp.test(req.url)) {\r\n              /**\r\n               * /baseURL重定向到/baseURL/\r\n               * TODO：\r\n               * /baseURL不存在，且存在index.html的时候再跳转\r\n               */\r\n              if (req.path === `/${baseURL}`) {\r\n                res.redirect(`/${baseURL}/`);\r\n              } else {\r\n                req.url = req.url.replace(regexp, '/');\r\n              }\r\n            }\r\n            next();\r\n          });\r\n        });\r\n      });\r\n\r\n    /**\r\n     * 热更新\r\n     */\r\n    webpackConfig.plugin('hmr').use(HotModuleReplacementPlugin);\r\n\r\n    /***\r\n     * 错误提示\r\n     */\r\n    webpackConfig.plugin('friendly-errors').use(FriendlyErrorsPlugin, [\r\n      {\r\n        compilationSuccessInfo: {\r\n          messages: [`你的应用程序运行在: ${url}`],\r\n          notes: [`你也能够使用下面地址访问: \\n\\n${ipv4}\\n`]\r\n        },\r\n        onErrors: (severity, errors) => {\r\n          // 打包失败或者具有警告也打印访问地址信息\r\n          setImmediate(() => {\r\n            logger.log(`\\n${chalk.bgBlue.black('', 'I', '')} 你的应用程序运行在: ${url}\\n`);\r\n            logger.log(`${chalk.bgWhite.black('', 'N', '')} 你也能够使用下面地址访问:\\n\\n${ipv4}\\n`);\r\n          });\r\n        }\r\n      }\r\n    ]);\r\n  });\r\n};\r\n"],"file":"dev.js"}