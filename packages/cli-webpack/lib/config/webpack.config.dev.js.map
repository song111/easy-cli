{"version":3,"sources":["../../src/config/webpack.config.dev.js"],"names":["api","mode","argv","port","chainWebpack","config","easyConfig","baseURL","themes","proxy","url","ipv4","map","join","extract","sourceMap","filename","chunkFilename","publicPath","watch","devtool","output","devServer","host","hot","contentBase","resolve","watchContentBase","disableHostCheck","clientLogLevel","compress","overlay","quiet","inline","when","oProxy","get","push","before","app","server","regexp","RegExp","use","req","res","next","test","path","redirect","replace","plugin","HotModuleReplacementPlugin","FriendlyErrorsPlugin","compilationSuccessInfo","messages","notes","onErrors","severity","errors","setImmediate","logger","log","chalk","bgBlue","black","bgWhite"],"mappings":"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","sourcesContent":["import styleLoader from './styleLoader'\nimport { HotModuleReplacementPlugin } from 'webpack'\nimport FriendlyErrorsPlugin from 'friendly-errors-webpack-plugin'\nimport { getIPv4URL, logger, chalk, formatProxy, detectPort } from '@chrissong/cli-utils'\n\nexport default async api => {\n  if (api.mode !== 'development') return\n  const port = await detectPort(api.argv.port)\n\n  api.chainWebpack(config => {\n    const { baseURL, themes, proxy } = api.easyConfig\n\n    const url = `http://localhost:${port}/${baseURL}`\n    const ipv4 = getIPv4URL(port, baseURL)\n      .map(url => `    ${url}`)\n      .join('\\n')\n\n    styleLoader(config, {\n      themes,\n      extract: false,\n      sourceMap: true,\n      filename: 'static/css/[name].css',\n      chunkFilename: 'static/css/[id].css',\n      publicPath: '../../'\n    })\n\n    /**\n     * 配置模式与devtool\n     */\n    config\n      .watch(true)\n      .mode('development')\n      .devtool('cheap-module-eval-source-map')\n      .output.filename('static/js/[name].js')\n\n    /**\n     * devServer\n     */\n    config.devServer\n      // 热更新ws地址与location.host保持一致\n      .host('0.0.0.0')\n      .port(port)\n      .hot(true)\n      .contentBase(api.resolve('public'))\n      .watchContentBase(true) // 检测public下文件变动\n      .publicPath('')\n      .disableHostCheck(true)\n      .clientLogLevel('warning')\n      .compress(true)\n      .overlay(true)\n      .quiet(true)\n      .inline(true)\n      .when(proxy, config => {\n        let oProxy = config.get('proxy')\n        if (!oProxy) oProxy = []\n        oProxy = formatProxy(oProxy)\n        oProxy.push(...formatProxy(proxy))\n        config.proxy(oProxy)\n      })\n      .when(baseURL, config => {\n        // 支持baseURL\n        config.before((app, server) => {\n          const regexp = new RegExp(`^/${baseURL}/?`)\n          app.use((req, res, next) => {\n            if (regexp.test(req.url)) {\n              /**\n               * /baseURL重定向到/baseURL/\n               * TODO：\n               * /baseURL不存在，且存在index.html的时候再跳转\n               */\n              if (req.path === `/${baseURL}`) {\n                res.redirect(`/${baseURL}/`)\n              } else {\n                req.url = req.url.replace(regexp, '/')\n              }\n            }\n            next()\n          })\n        })\n      })\n\n    /**\n     * 热更新\n     */\n    config.plugin('hmr').use(HotModuleReplacementPlugin)\n\n    /***\n     * 错误提示\n     */\n    config.plugin('friendly-errors').use(FriendlyErrorsPlugin, [\n      {\n        compilationSuccessInfo: {\n          messages: [`你的应用程序运行在: ${url}`],\n          notes: [`你也能够使用下面地址访问: \\n\\n${ipv4}\\n`]\n        },\n        onErrors: (severity, errors) => {\n          // 打包失败或者具有警告也打印访问地址信息\n          setImmediate(() => {\n            logger.log(`\\n${chalk.bgBlue.black('', 'I', '')} 你的应用程序运行在: ${url}\\n`)\n            logger.log(`${chalk.bgWhite.black('', 'N', '')} 你也能够使用下面地址访问:\\n\\n${ipv4}\\n`)\n          })\n        }\n      }\n    ])\n  })\n}\n"],"file":"webpack.config.dev.js"}