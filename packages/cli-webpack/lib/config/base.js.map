{"version":3,"sources":["../../src/config/base.js"],"names":["api","chainWebpack","config","env","easyConfig","alias","pages","context","target","output","path","resolve","publicPath","when","Object","keys","forEach","key","set","extensions","merge","end","mainFields","modules","resolveLoader","node","setImmediate","process","dgram","fs","net","tls","child_process","optimization","splitChunks","chunks","name","minSize","maxSize","sideEffects","removeEmptyChunks","mergeDuplicateChunks","module","rule","test","exclude","add","use","loader","options","limit","plugin","DefinePlugin","reduce","envs","CaseSensitivePathsPlugin","ProgressPlugin","activeModules","entry","template","Array","isArray","en","HtmlWebpackPlugin","filename"],"mappings":"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","sourcesContent":["import { DefinePlugin, ProgressPlugin } from 'webpack';\nimport CaseSensitivePathsPlugin from 'case-sensitive-paths-webpack-plugin';\nimport HtmlWebpackPlugin from 'html-webpack-plugin';\n\n/**\n * webpack通用配置\n * @param{Object} api api实例\n */\n\nexport default (api) => {\n  api.chainWebpack((config) => {\n    const env = api.env;\n    const { alias, pages = {} } = api.easyConfig;\n\n    // 设置context\n    config.context(api.context).target('web');\n\n    // output配置\n    config.output.path(api.resolve('build')).publicPath('./');\n\n    /**\n     * resolve配置\n     */\n    config.resolve\n      .when(alias, config => {\n      // 路径别名\n        Object.keys(alias).forEach(key => {\n          config.alias.set(key, api.resolve(alias[key]))\n        })\n      })\n      .extensions.merge(['.mjs', '.js', '.jsx', '.json', '.wasm'])\n      .end()\n      .mainFields.merge(['browser', 'main', 'module'])\n      .end()\n      .modules.merge(['node_modules', api.resolve('node_modules')])\n      .end()\n      .end()\n      .resolveLoader.modules.merge([\n        'node_modules',\n        api.resolve('node_modules')\n      ])\n\n    /**\n     * 设置node变量\n     */\n    config.node.merge({\n      setImmediate: false,\n      process: 'mock',\n      dgram: 'empty',\n      fs: 'empty',\n      net: 'empty',\n      tls: 'empty',\n      child_process: 'empty'\n    });\n\n    /**\n     * 代码切割与打包优化\n     */\n    config.optimization\n      .splitChunks({\n        chunks: 'all',\n        name: false,\n        minSize: 600 * 1024,\n        maxSize: 1000 * 1024\n      })\n      .sideEffects(true)\n      .removeEmptyChunks(true)\n      .mergeDuplicateChunks(true);\n\n    /**\n     * eslint配置\n     */\n    // config.module\n    //   .rule('eslint')\n    //   .test(/\\.jsx?$/)\n    //   .pre()\n    //   .exclude.add(api.resolve('node_modules'))\n    //   .end()\n    //   .use('eslint-loader')\n    //   .loader('eslint-loader')\n    //   .options({\n    //     emitError: false,\n    //     emitWarning: true,\n    //     formatter: 'eslint/lib/cli-engine/formatters/codeframe'\n    //   });\n\n    /**\n     * babel配置\n     */\n    config.module\n      .rule('babel')\n      .test(/\\.jsx?$/)\n      .exclude.add(api.resolve('node_modules'))\n      .end()\n      .use('babel-loader')\n      .loader('babel-loader');\n\n    /**\n     * 图片文件loader\n     */\n    config.module\n      .rule('images')\n      .test(/\\.(png|jpe?g|gif|webp)(\\?.*)?$/)\n      .use('url-loader')\n      .loader('url-loader')\n      .options({\n        limit: 8192,\n        name: 'static/images/[name].[hash:7].[ext]'\n      });\n\n    /**\n     * svg文件loader\n     * 方便单独处理svg，例如转换为react组件\n     */\n    config.module\n      .rule('svg')\n      .test(/\\.svg(\\?.*)?$/)\n      .use('url-loader')\n      .loader('url-loader')\n      .options({\n        limit: 8192,\n        name: 'static/images/[name].[hash:7].[ext]'\n      });\n\n    /**\n     * 音视频媒体文件loader\n     */\n    config.module\n      .rule('media')\n      .test(/\\.(mp4|webm|ogg|mp3|wav|flac|aac)(\\?.*)?$/)\n      .use('url-loader')\n      .loader('url-loader')\n      .options({\n        limit: 8192,\n        name: 'static/media/[name].[hash:7].[ext]'\n      });\n\n    /**\n     * 字体文件loader\n     */\n    config.module\n      .rule('fonts')\n      .test(/\\.(woff2?|eot|ttf|otf)(\\?.*)?$/)\n      .use('url-loader')\n      .loader('url-loader')\n      .options({\n        limit: 8192,\n        name: 'static/fonts/[name].[hash:7].[ext]'\n      });\n\n    /**\n     * 环境变量\n     */\n    config.plugin('define').use(DefinePlugin, [\n      {\n        'process.env': Object.keys(env).reduce((envs, key) => {\n          envs[key] = `\"${env[key]}\"`;\n          return envs;\n        }, {})\n      }\n    ]);\n\n    /**\n     * 区分大小写路径\n     */\n    config.plugin('case-sensitive-paths').use(CaseSensitivePathsPlugin);\n\n    /**\n     * 进度条\n     */\n    config.plugin('progress').use(ProgressPlugin, [\n      {\n        activeModules: false\n      }\n    ]);\n\n    debugger\n    // config.plugin('html-index').use(HtmlWebpackPlugin, [{\n    //   filename: 'index.html',\n    //   template: api.resolve('./public/index.html'),\n    //   hash: true\n    // }])\n\n    // config.entry('index')\n    //   .add('./src/index.js')\n\n    /**\n     * 打包入口与html模板\n     */\n    Object.keys(pages).forEach((key) => {\n      const { entry, template } = pages[key];\n\n      if (Array.isArray(entry)) {\n        entry.forEach((en) => config.entry(key).add(en));\n      } else {\n        debugger\n        config.entry(key).add(entry);\n      }\n\n      debugger\n      config.when(template, (config) => {\n        config.plugin(`html-${key}`).use(HtmlWebpackPlugin, [\n          {\n            filename: `${key}.html`,\n            template: api.resolve(template)\n          }\n        ]);\n      });\n    });\n    /**************/\n  });\n};\n"],"file":"base.js"}