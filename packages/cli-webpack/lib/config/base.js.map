{"version":3,"sources":["../../src/config/base.js"],"names":["api","chainWebpack","webpackConfig","env","easyConfig","alias","pages","context","target","output","path","resolve","publicPath","when","Object","keys","forEach","key","set","extensions","merge","end","mainFields","modules","node","setImmediate","process","dgram","fs","net","tls","child_process","optimization","splitChunks","chunks","name","minSize","maxSize","sideEffects","removeEmptyChunks","mergeDuplicateChunks","module","rule","test","pre","exclude","add","use","loader","options","emitError","emitWarning","formatter","limit","plugin","DefinePlugin","reduce","envs","CaseSensitivePathsPlugin","ProgressPlugin","activeModules","entry","template","props","Array","isArray","en","HtmlWebpackPlugin","filename","templateParameters","compilation","assets","webpack","getStats","toJson","htmlWebpackPlugin","files","inject","chunksSortMode"],"mappings":"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","sourcesContent":["import { DefinePlugin, ProgressPlugin } from 'webpack';\r\nimport CaseSensitivePathsPlugin from 'case-sensitive-paths-webpack-plugin';\r\nimport HtmlWebpackPlugin from 'html-webpack-plugin';\r\n\r\n/**\r\n * webpack通用配置\r\n * @param{Object} api api实例\r\n */\r\n\r\nexport default (api) => {\r\n  api.chainWebpack((webpackConfig) => {\r\n    const env = api.env;\r\n    const { alias, pages = {} } = api.easyConfig;\r\n\r\n    // 设置context\r\n    webpackConfig.context(api.context).target('web');\r\n\r\n    // output配置\r\n    webpackConfig.output.path(api.resolve('dist')).publicPath('./');\r\n\r\n    // resolve 配置\r\n    webpackConfig.resolve\r\n      .when(alias, (webpackConfig) => {\r\n        Object.keys(alias).forEach((key) => {\r\n          webpackConfig.alias.set(key, api.resolve(alias[key]));\r\n        });\r\n      })\r\n      .extensions.merge(['.js', '.jsx', '.json', '.ts', 'tsx', 'css'])\r\n      .end()\r\n      .mainFields.merge(['browser', 'main', 'module'])\r\n      .end()\r\n      .modules.merge(['node_modules', api.resolve('node_modules')]);\r\n\r\n    /**\r\n     * 设置node变量\r\n     */\r\n    webpackConfig.node.merge({\r\n      setImmediate: false,\r\n      process: 'mock',\r\n      dgram: 'empty',\r\n      fs: 'empty',\r\n      net: 'empty',\r\n      tls: 'empty',\r\n      child_process: 'empty'\r\n    });\r\n\r\n    /**\r\n     * 代码切割与打包优化\r\n     */\r\n    webpackConfig.optimization\r\n      .splitChunks({\r\n        chunks: 'all',\r\n        name: false,\r\n        minSize: 600 * 1024,\r\n        maxSize: 1000 * 1024\r\n      })\r\n      .sideEffects(true)\r\n      .removeEmptyChunks(true)\r\n      .mergeDuplicateChunks(true);\r\n\r\n    /**\r\n     * eslint配置\r\n     */\r\n    webpackConfig.module\r\n      .rule('eslint')\r\n      .test(/\\.jsx?$/)\r\n      .pre()\r\n      .exclude.add(api.resolve('node_modules'))\r\n      .end()\r\n      .use('eslint-loader')\r\n      .loader('eslint-loader')\r\n      .options({\r\n        emitError: false,\r\n        emitWarning: true,\r\n        formatter: 'eslint/lib/cli-engine/formatters/codeframe'\r\n      });\r\n\r\n    /**\r\n     * babel配置\r\n     */\r\n    webpackConfig.module\r\n      .rule('babel')\r\n      .test(/\\.jsx?$/)\r\n      .exclude.add(api.resolve('node_modules'))\r\n      .end()\r\n      .use('babel-loader')\r\n      .loader('babel-loader');\r\n\r\n    /**\r\n     * 图片文件loader\r\n     */\r\n    webpackConfig.module\r\n      .rule('images')\r\n      .test(/\\.(png|jpe?g|gif|webp)(\\?.*)?$/)\r\n      .use('url-loader')\r\n      .loader('url-loader')\r\n      .options({\r\n        limit: 8192,\r\n        name: 'static/images/[name].[hash:7].[ext]'\r\n      });\r\n\r\n    /**\r\n     * svg文件loader\r\n     * 方便单独处理svg，例如转换为react组件\r\n     */\r\n    webpackConfig.module\r\n      .rule('svg')\r\n      .test(/\\.svg(\\?.*)?$/)\r\n      .use('url-loader')\r\n      .loader('url-loader')\r\n      .options({\r\n        limit: 8192,\r\n        name: 'static/images/[name].[hash:7].[ext]'\r\n      });\r\n\r\n    /**\r\n     * 音视频媒体文件loader\r\n     */\r\n    webpackConfig.module\r\n      .rule('media')\r\n      .test(/\\.(mp4|webm|ogg|mp3|wav|flac|aac)(\\?.*)?$/)\r\n      .use('url-loader')\r\n      .loader('url-loader')\r\n      .options({\r\n        limit: 8192,\r\n        name: 'static/media/[name].[hash:7].[ext]'\r\n      });\r\n\r\n    /**\r\n     * 字体文件loader\r\n     */\r\n    webpackConfig.module\r\n      .rule('fonts')\r\n      .test(/\\.(woff2?|eot|ttf|otf)(\\?.*)?$/)\r\n      .use('url-loader')\r\n      .loader('url-loader')\r\n      .options({\r\n        limit: 8192,\r\n        name: 'static/fonts/[name].[hash:7].[ext]'\r\n      });\r\n\r\n    /**\r\n     * 环境变量\r\n     */\r\n    webpackConfig.plugin('define').use(DefinePlugin, [\r\n      {\r\n        'process.env': Object.keys(env).reduce((envs, key) => {\r\n          envs[key] = `\"${env[key]}\"`;\r\n          return envs;\r\n        }, {})\r\n      }\r\n    ]);\r\n\r\n    /**\r\n     * 区分大小写路径\r\n     */\r\n    webpackConfig.plugin('case-sensitive-paths').use(CaseSensitivePathsPlugin);\r\n\r\n    /**\r\n     * 进度条\r\n     */\r\n    webpackConfig.plugin('progress').use(ProgressPlugin, [\r\n      {\r\n        activeModules: false\r\n      }\r\n    ]);\r\n\r\n    /**\r\n     * 打包入口与html模板\r\n     */\r\n    Object.keys(pages).forEach((key) => {\r\n      const { entry, template, ...props } = pages[key];\r\n\r\n      if (Array.isArray(entry)) {\r\n        entry.forEach((en) => webpackConfig.entry(key).add(en));\r\n      } else {\r\n        webpackConfig.entry(key).add(entry);\r\n      }\r\n      webpackConfig.when(template, (webpackConfig) => {\r\n        webpackConfig.plugin(`html-${key}`).use(HtmlWebpackPlugin, [\r\n          {\r\n            filename: `${key}.html`,\r\n            template: api.resolve(template),\r\n            templateParameters: (compilation, assets, options) => ({\r\n              ...env,\r\n              compilation: compilation,\r\n              webpack: compilation.getStats().toJson(),\r\n              webpackConfig: compilation.options,\r\n              htmlWebpackPlugin: {\r\n                files: assets,\r\n                options: options\r\n              }\r\n            }),\r\n            inject: true,\r\n            chunksSortMode: 'auto',\r\n            chunks: [key],\r\n            ...props\r\n          }\r\n        ]);\r\n      });\r\n    });\r\n  });\r\n};\r\n"],"file":"base.js"}