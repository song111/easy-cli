{"version":3,"sources":["../../src/config/styleLoader.js"],"names":["config","themes","extract","sourceMap","filename","chunkFilename","publicPath","styleLoader","rule","test","loader","options","indentedSyntax","preferPathResolver","modules","javascriptEnabled","when","plugin","use","MiniCssExtractPlugin","module","oneOf","oneOfLoader","end","extractLoader","mode","localIdentName","localsConvention","importLoaders"],"mappings":"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","sourcesContent":["import MiniCssExtractPlugin, { loader as extractLoader } from 'mini-css-extract-plugin';\n\n/**\n * @param {*} config webpack-chain配置对象\n * @param {*} param1\n * themes @uyun/less-plugin-themes 主题数据，不传则不启用插件\n * extract 是否分离css为单独文件\n * sourceMap 是否生成sourceMap\n * filename 生成文件路径\n * chunkFilename  生成文件路径\n * publicPath 资源文件路径publicPath，以output文件夹为根路径\n */\nexport default (config, { themes, extract, sourceMap, filename, chunkFilename, publicPath }) => {\n  /**\n   * css loader\n   */\n  styleLoader(config, {\n    rule: 'css',\n    test: /\\.css$/,\n    extract,\n    sourceMap,\n    publicPath\n  });\n\n  /**\n   * postcss-loader\n   */\n  styleLoader(config, {\n    rule: 'postcss',\n    test: /\\.p(ost)?css$/,\n    extract,\n    sourceMap,\n    publicPath\n  });\n\n  /**\n   * scss-loader\n   */\n  styleLoader(config, {\n    rule: 'scss',\n    test: /\\.scss$/,\n    extract,\n    sourceMap,\n    publicPath,\n    loader: 'sass-loader'\n  });\n\n  /**\n   * sass-loader\n   */\n  styleLoader(config, {\n    rule: 'sass',\n    test: /\\.sass$/,\n    extract,\n    sourceMap,\n    publicPath,\n    loader: 'sass-loader',\n    options: {\n      indentedSyntax: true\n    }\n  });\n\n  /**\n   * stylus-loader\n   */\n  styleLoader(config, {\n    rule: 'stylus',\n    test: /\\.styl(us)?$/,\n    extract,\n    sourceMap,\n    publicPath,\n    loader: 'stylus-loader',\n    options: {\n      preferPathResolver: 'webpack'\n    }\n  });\n\n  /**\n   * less-loader\n   */\n  styleLoader(config, {\n    rule: 'less',\n    test: /\\.less$/,\n    extract,\n    sourceMap,\n    publicPath,\n    loader: 'less-loader',\n    options: ({ modules }) => {\n      const options = { javascriptEnabled: true };\n\n      return options;\n    }\n  });\n\n  /**\n   * 分离css\n   */\n  config.when(extract, (config) =>\n    config.plugin('extract-css').use(MiniCssExtractPlugin, [{ filename, chunkFilename }])\n  );\n\n  return config;\n};\n\n/**\n * 获取对饮的style-loader配置\n * @param {*} config webpack-chain配置对象\n * @param {*} param1\n * rule 规则名称\n * test 匹配文件正则表达式\n * extract 是否分离css到独立文件\n * sourceMap 是否生成sourceMap\n * publicPath 资源文件路径publicPath\n * loader 除了css-loader postcss-loader外的其他预处理语言loader\n * options 指定loader的参数选项，可以为对象也可以为函数\n */\nfunction styleLoader (config, { rule, test, extract, sourceMap, publicPath, loader, options }) {\n  config.module\n    .rule(rule)\n    .test(test)\n    .oneOf('modules')\n    .when(true, (config) => oneOfLoader(config, { modules: true, extract, sourceMap, publicPath, loader, options }))\n    .end()\n    .oneOf('normal')\n    .when(true, (config) => oneOfLoader(config, { modules: false, extract, sourceMap, publicPath, loader, options }));\n  return config;\n}\n\nfunction oneOfLoader (config, { modules, extract, sourceMap, publicPath, loader, options }) {\n  /**\n   * style-loader\n   */\n  config\n    .when(modules, (config) => config.test(/\\.module\\.\\w+$/))\n    .when(\n      extract,\n      (config) => {\n        config.use('extract-loader').loader(extractLoader).options({\n          publicPath\n        });\n      },\n      (config) => {\n        config.use('style-loader').loader('style-loader');\n      }\n    );\n\n  /**\n   * css-loader\n   */\n  config\n    .use('css-loader')\n    .loader('css-loader')\n    .when(\n      modules,\n      (config) => {\n        config.options({\n          modules: {\n            mode: 'local',\n            localIdentName: '[local]--[hash:base64:7]'\n          },\n          sourceMap,\n          localsConvention: 'camelCaseOnly',\n          importLoaders: 1\n        });\n      },\n      (config) => {\n        config.options({\n          modules: false,\n          sourceMap,\n          importLoaders: 1\n        });\n      }\n    );\n\n  /**\n   * postcss-loader\n   */\n  config.use('postcss-loader').loader('postcss-loader').options({\n    sourceMap\n  });\n\n  /**\n   * 其他预处理loader\n   */\n  config.when(loader, (config) => {\n    config\n      .use(loader)\n      .loader(loader)\n      .when(\n        typeof options === 'function',\n        (config) => {\n          config.options({\n            ...options({ modules }),\n            sourceMap\n          });\n        },\n        (config) => {\n          config.options({\n            ...options,\n            sourceMap\n          });\n        }\n      );\n  });\n\n  return config;\n}\n"],"file":"styleLoader.js"}