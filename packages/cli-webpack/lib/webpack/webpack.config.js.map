{"version":3,"sources":["../../src/webpack/webpack.config.js"],"names":["api","chainWebpack","config","env","easyConfig","alias","pages","context","target","output","path","resolve","publicPath","when","Object","keys","forEach","key","set","extensions","merge","end","mainFields","modules","resolveLoader","node","setImmediate","process","dgram","fs","net","tls","child_process","optimization","splitChunks","chunks","name","minSize","maxSize","sideEffects","removeEmptyChunks","mergeDuplicateChunks","module","rule","test","pre","exclude","add","use","loader","options","emitError","emitWarning","formatter","limit","plugin","DefinePlugin","reduce","envs","CaseSensitivePathsPlugin","ProgressPlugin","activeModules","IgnorePlugin","resourceRegExp","contextRegExp","entry","template","Array","isArray","en","HtmlWebpackPlugin","filename","templateParameters","compilation","assets","webpack","getStats","toJson","webpackConfig","htmlWebpackPlugin","files","inject","chunksSortMode","props"],"mappings":"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","sourcesContent":["import { DefinePlugin, ProgressPlugin, IgnorePlugin } from 'webpack';\nimport CaseSensitivePathsPlugin from 'case-sensitive-paths-webpack-plugin';\nimport HtmlWebpackPlugin from 'html-webpack-plugin';\n\n/**\n * webpack通用配置\n * @param{Object} api api实例\n */\n\nexport default (api) => {\n  api.chainWebpack((config) => {\n    const env = api.env();\n    const { alias, pages = {} } = api.easyConfig();\n\n    // 设置context\n    config.context(api.context()).target('web');\n\n    // output配置\n    config.output.path(api.resolve('build')).publicPath('./');\n\n    /**\n     * resolve配置\n     */\n    config.resolve\n      .when(alias, (config) => {\n        // 路径别名\n        Object.keys(alias).forEach((key) => {\n          config.alias.set(key, api.resolve(alias[key]));\n        });\n      })\n      .extensions.merge(['.mjs', '.js', '.jsx', '.json', '.wasm'])\n      .end()\n      .mainFields.merge(['browser', 'main', 'module'])\n      .end()\n      .modules.merge(['node_modules', api.resolve('node_modules')])\n      .end()\n      .end()\n      .resolveLoader.modules.merge([\n        'node_modules',\n        api.resolve('node_modules'),\n        api.resolve('node_modules/@chrissong/uyun/cli-webpack/node_modules')\n      ]);\n\n    /**\n     * 设置node变量\n     */\n    config.node.merge({\n      setImmediate: false,\n      process: 'mock',\n      dgram: 'empty',\n      fs: 'empty',\n      net: 'empty',\n      tls: 'empty',\n      child_process: 'empty'\n    });\n\n    /**\n     * 代码切割与打包优化\n     */\n    config.optimization\n      .splitChunks({\n        chunks: 'all',\n        name: false,\n        minSize: 600 * 1024,\n        maxSize: 1000 * 1024\n      })\n      .sideEffects(true)\n      .removeEmptyChunks(true)\n      .mergeDuplicateChunks(true);\n\n    /**\n     * eslint配置\n     */\n    config.module\n      .rule('eslint')\n      .test(/\\.jsx?$/)\n      .pre()\n      .exclude.add(api.resolve('node_modules'))\n      .end()\n      .use('eslint-loader')\n      .loader('eslint-loader')\n      .options({\n        emitError: false,\n        emitWarning: true,\n        formatter: 'eslint/lib/cli-engine/formatters/codeframe'\n      });\n\n    /**\n     * babel配置\n     */\n    config.module\n      .rule('babel')\n      .test(/\\.jsx?$/)\n      .exclude.add(api.resolve('node_modules'))\n      .end()\n      .use('babel-loader')\n      .loader('babel-loader');\n\n    /**\n     * 图片文件loader\n     */\n    config.module\n      .rule('images')\n      .test(/\\.(png|jpe?g|gif|webp)(\\?.*)?$/)\n      .use('url-loader')\n      .loader('url-loader')\n      .options({\n        limit: 8192,\n        name: 'static/images/[name].[hash:7].[ext]'\n      });\n\n    /**\n     * svg文件loader\n     * 方便单独处理svg，例如转换为react组件\n     */\n    config.module\n      .rule('svg')\n      .test(/\\.svg(\\?.*)?$/)\n      .use('url-loader')\n      .loader('url-loader')\n      .options({\n        limit: 8192,\n        name: 'static/images/[name].[hash:7].[ext]'\n      });\n\n    /**\n     * 音视频媒体文件loader\n     */\n    config.module\n      .rule('media')\n      .test(/\\.(mp4|webm|ogg|mp3|wav|flac|aac)(\\?.*)?$/)\n      .use('url-loader')\n      .loader('url-loader')\n      .options({\n        limit: 8192,\n        name: 'static/media/[name].[hash:7].[ext]'\n      });\n\n    /**\n     * 字体文件loader\n     */\n    config.module\n      .rule('fonts')\n      .test(/\\.(woff2?|eot|ttf|otf)(\\?.*)?$/)\n      .use('url-loader')\n      .loader('url-loader')\n      .options({\n        limit: 8192,\n        name: 'static/fonts/[name].[hash:7].[ext]'\n      });\n\n    /**\n     * 环境变量\n     */\n    config.plugin('define').use(DefinePlugin, [\n      {\n        'process.env': Object.keys(env).reduce((envs, key) => {\n          envs[key] = `\"${env[key]}\"`;\n          return envs;\n        }, {})\n      }\n    ]);\n\n    /**\n     * 区分大小写路径\n     */\n    config.plugin('case-sensitive-paths').use(CaseSensitivePathsPlugin).end();\n\n    /**\n     * 进度条\n     */\n    config.plugin('progress').use(ProgressPlugin, [\n      {\n        activeModules: false\n      }\n    ]);\n\n    /**\n     * 忽略moment locale文件\n     */\n    config.plugin('ignore-moment').use(IgnorePlugin, [\n      {\n        resourceRegExp: /^\\.\\/locale$/,\n        contextRegExp: /moment$/\n      }\n    ]);\n\n    /**\n     * 打包入口与html模板\n     */\n    Object.keys(pages).forEach((key) => {\n      const { entry, template } = pages[key];\n\n      if (Array.isArray(entry)) {\n        entry.forEach((en) => config.entry(key).add(en));\n      } else {\n        config.entry(key).add(entry);\n      }\n\n      config.when(template, (config) => {\n        config.plugin(`html-${key}`).use(HtmlWebpackPlugin, [\n          {\n            filename: `${key}.html`,\n            template: api.resolve(template),\n            templateParameters: (compilation, assets, options) => ({\n              ...env,\n              compilation: compilation,\n              webpack: compilation.getStats().toJson(),\n              webpackConfig: compilation.options,\n              htmlWebpackPlugin: {\n                files: assets,\n                options: options\n              }\n            }),\n            inject: true,\n            chunksSortMode: 'auto',\n            chunks: [key],\n            ...props\n          }\n        ]);\n      });\n    });\n    /**************/\n  });\n};\n"],"file":"webpack.config.js"}