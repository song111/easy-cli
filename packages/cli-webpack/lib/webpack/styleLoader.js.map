{"version":3,"sources":["../../src/webpack/styleLoader.js"],"names":["config","extract","sourceMap","publicPath","styleLoader","rule","test","loader","options","modules","javascriptEnabled","module","oneOf","when","oneOfLoader","end","use","extractLoader","mode","localIdentName","localsConvention","importLoaders"],"mappings":"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","sourcesContent":["import { loader as extractLoader } from 'mini-css-extract-plugin'\n\n/**\n * @param {*} config webpack-chain配置对象\n * @param {*} param1\n * extract 是否分离css问单独文件\n * sourceMap 是否生成sourceMap\n * publicPath 资源文件路径publicPath，以output文件夹为根路径\n */\nexport default (config, { extract, sourceMap, publicPath }) => {\n  /**\n   * css loader\n   */\n  styleLoader(config, {\n    rule: 'css',\n    test: /\\.css$/,\n    extract,\n    sourceMap,\n    publicPath\n  })\n\n  /**\n   * postcss-loader\n   */\n  styleLoader(config, {\n    rule: 'postcss',\n    test: /\\.p(ost)?css$/,\n    extract,\n    sourceMap,\n    publicPath\n  })\n\n  /**\n   * less-loader\n   */\n  styleLoader(config, {\n    rule: 'less',\n    test: /\\.less$/,\n    extract,\n    sourceMap,\n    publicPath,\n    loader: 'less-loader',\n    options: ({ modules }) => {\n      const options = { javascriptEnabled: true }\n      return options\n    }\n  })\n\n  return config\n}\n\n/**\n * 获取对应的style-loader配置\n * @param {*} config webpack-chain配置对象\n * @param {*} param1\n * rule 规则名称\n * test 匹配文件正则表达式\n * extract 是否分离css到独立文件\n * sourceMap 是否生成sourceMap\n * publicPath 资源文件路径publicPath\n * loader 除了css-loader postcss-loader外的其他预处理语言loader\n * options 指定loader的参数选项，可以为对象也可以为函数\n */\nfunction styleLoader (config, { rule, test, extract, sourceMap, publicPath, loader, options }) {\n  config.module\n    .rule(rule)\n    .test(test)\n    .oneOf('modules')\n    .when(true, config => oneOfLoader(config, { modules: true, extract, sourceMap, publicPath, loader, options }))\n    .end()\n    .oneOf('normal')\n    .when(true, config => oneOfLoader(config, { modules: false, extract, sourceMap, publicPath, loader, options }))\n  return config\n}\n\nfunction oneOfLoader (config, { modules, extract, sourceMap, publicPath, loader, options }) {\n  /**\n   * style-loader\n   */\n  config\n    .when(modules, config => config.test(/\\.module\\.\\w+$/))\n    .when(\n      extract,\n      config => {\n        config\n          .use('extract-loader')\n          .loader(extractLoader)\n      },\n      config => {\n        config\n          .use('style-loader')\n          .loader('style-loader')\n      }\n    )\n\n  /**\n   * css-loader\n   */\n  config\n    .use('css-loader')\n    .loader('css-loader')\n    .when(\n      modules,\n      config => {\n        config.options({\n          modules: {\n            mode: 'local',\n            localIdentName: '[local]--[hash:base64:7]'\n          },\n          sourceMap,\n          localsConvention: 'camelCaseOnly',\n          importLoaders: 1\n        })\n      },\n      config => {\n        config.options({\n          modules: false,\n          sourceMap,\n          importLoaders: 1\n        })\n      }\n    )\n\n  /**\n   * postcss-loader\n   */\n  config\n    .use('postcss-loader')\n    .loader('postcss-loader')\n    .options({\n      sourceMap\n    })\n\n  /**\n   * 其他预处理loader\n   */\n  config.when(loader, config => {\n    config\n      .use(loader)\n      .loader(loader)\n      .when(\n        typeof options === 'function',\n        config => {\n          config.options({\n            ...options({ modules }),\n            sourceMap\n          })\n        },\n        config => {\n          config.options({\n            ...options,\n            sourceMap\n          })\n        }\n      )\n  })\n\n  return config\n}\n"],"file":"styleLoader.js"}