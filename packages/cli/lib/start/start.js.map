{"version":3,"sources":["../../src/start/start.js"],"names":["start","cli","fork","path","resolve","__dirname","argv","cwd","env","stdio","on","msg","exit","logger","log","startProcess","watcher","chokidar","watch","pid"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AAEA,MAAMA,KAAK,GAAIC,GAAD,IAAS;AACrB;AACA,SAAOA,GAAG,CACPC,IADI,CACCC,cAAKC,OAAL,CAAaC,SAAb,EAAwB,aAAxB,CADD,EACyCJ,GAAG,CAACK,IAD7C,EACmD;AACtDC,IAAAA,GAAG,EAAEN,GAAG,CAACM,GAD6C;AAEtDC,IAAAA,GAAG,EAAEP,GAAG,CAACO,GAF6C;AAGtDC,IAAAA,KAAK,EAAE;AAH+C,GADnD,EAMJC,EANI,CAMD,SANC,EAMWC,GAAD,IAASA,GAAG,KAAK,iBAAR,IAA6BV,GAAG,CAACW,IAAJ,CAAS,CAAT,CANhD,CAAP;AAOD,CATD;;eAWe,CAACX,GAAD,EAAMK,IAAN,KAAe;AAC5BO,mBAAOC,GAAP,CAAW,qBAAX;;AAEA,MAAIC,YAAY,GAAGf,KAAK,CAACC,GAAD,CAAxB,CAH4B,CAK5B;;AACA,QAAMe,OAAO,GAAGC,kBAASC,KAAT,CACd,CACE,MADF,EAEE,WAFF,EAGE,cAHF,EAIE,eAJF,EAKE,UALF,EAME,iBANF,EAOE,iBAPF,EAQE,gBARF,EASE,eATF,CADc,EAYd;AACEX,IAAAA,GAAG,EAAEN,GAAG,CAACM;AADX,GAZc,CAAhB;;AAiBAS,EAAAA,OAAO,CAACN,EAAR,CAAW,QAAX,EAAqB,YAAY;AAC/BG,qBAAOC,GAAP,CAAW,2BAAX;;AACA,UAAM,oBAAMC,YAAY,CAACI,GAAnB,CAAN;AACAJ,IAAAA,YAAY,GAAGf,KAAK,CAACC,GAAD,CAApB;AACD,GAJD;AAKD,C","sourcesContent":["import path from 'path';\r\nimport chokidar from 'chokidar';\r\nimport fkill from 'fkill';\r\nimport { logger } from '@chrissong/cli-utils';\r\n\r\nconst start = (cli) => {\r\n  debugger;\r\n  return cli\r\n    .fork(path.resolve(__dirname, './server.js'), cli.argv, {\r\n      cwd: cli.cwd,\r\n      env: cli.env,\r\n      stdio: 'inherit'\r\n    })\r\n    .on('message', (msg) => msg === 'EXIT_WITH_ERROR' && cli.exit(1));\r\n};\r\n\r\nexport default (cli, argv) => {\r\n  logger.log('📦  正在启动开发服务,请稍等...');\r\n\r\n  let startProcess = start(cli);\r\n\r\n  //   监听配置文件的变化\r\n  const watcher = chokidar.watch(\r\n    [\r\n      '.env',\r\n      '.eslintrc',\r\n      '.eslintrc.js',\r\n      '.eslintignore',\r\n      '.babelrc',\r\n      'babel.config.js',\r\n      '.browserslistrc',\r\n      'easy.config.js',\r\n      'tsconfig.json'\r\n    ],\r\n    {\r\n      cwd: cli.cwd\r\n    }\r\n  );\r\n\r\n  watcher.on('change', async () => {\r\n    logger.log('📦  检测到配置文件变化,服务正在自动重启...');\r\n    await fkill(startProcess.pid);\r\n    startProcess = start(cli);\r\n  });\r\n};\r\n"],"file":"start.js"}