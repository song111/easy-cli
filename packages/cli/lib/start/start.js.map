{"version":3,"sources":["../../src/start/start.js"],"names":["start","cli","fork","path","resolve","__dirname","argv","cwd","env","stdio","on","msg","exit","logger","log","startProcess","watcher","chokidar","watch","pid"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AAEA,MAAMA,KAAK,GAAIC,GAAD,IAAS;AACrB;AACA,SAAOA,GAAG,CACPC,IADI,CACCC,cAAKC,OAAL,CAAaC,SAAb,EAAwB,aAAxB,CADD,EACyCJ,GAAG,CAACK,IAD7C,EACmD;AACtDC,IAAAA,GAAG,EAAEN,GAAG,CAACM,GAD6C;AAEtDC,IAAAA,GAAG,EAAEP,GAAG,CAACO,GAF6C;AAGtDC,IAAAA,KAAK,EAAE;AAH+C,GADnD,EAMJC,EANI,CAMD,SANC,EAMWC,GAAD,IAASA,GAAG,KAAK,iBAAR,IAA6BV,GAAG,CAACW,IAAJ,CAAS,CAAT,CANhD,CAAP;AAOD,CATD;;eAWe,CAACX,GAAD,EAAMK,IAAN,KAAe;AAC5BO,mBAAOC,GAAP,CAAW,qBAAX;;AAEA,MAAIC,YAAY,GAAGf,KAAK,CAACC,GAAD,CAAxB,CAH4B,CAK5B;;AACA,QAAMe,OAAO,GAAGC,kBAASC,KAAT,CACd,CACE,MADF,EAEE,WAFF,EAGE,cAHF,EAIE,eAJF,EAKE,UALF,EAME,iBANF,EAOE,iBAPF,EAQE,gBARF,EASE,eATF,CADc,EAYd;AACEX,IAAAA,GAAG,EAAEN,GAAG,CAACM;AADX,GAZc,CAAhB;;AAiBAS,EAAAA,OAAO,CAACN,EAAR,CAAW,QAAX,EAAqB,YAAY;AAC/BG,qBAAOC,GAAP,CAAW,2BAAX;;AACA,UAAM,oBAAMC,YAAY,CAACI,GAAnB,CAAN;AACAJ,IAAAA,YAAY,GAAGf,KAAK,CAACC,GAAD,CAApB;AACD,GAJD;AAKD,C","sourcesContent":["import path from 'path';\nimport chokidar from 'chokidar';\nimport fkill from 'fkill';\nimport { logger } from '@chrissong/cli-utils';\n\nconst start = (cli) => {\n  debugger;\n  return cli\n    .fork(path.resolve(__dirname, './server.js'), cli.argv, {\n      cwd: cli.cwd,\n      env: cli.env,\n      stdio: 'inherit'\n    })\n    .on('message', (msg) => msg === 'EXIT_WITH_ERROR' && cli.exit(1));\n};\n\nexport default (cli, argv) => {\n  logger.log('📦  正在启动开发服务,请稍等...');\n\n  let startProcess = start(cli);\n\n  //   监听配置文件的变化\n  const watcher = chokidar.watch(\n    [\n      '.env',\n      '.eslintrc',\n      '.eslintrc.js',\n      '.eslintignore',\n      '.babelrc',\n      'babel.config.js',\n      '.browserslistrc',\n      'easy.config.js',\n      'tsconfig.json'\n    ],\n    {\n      cwd: cli.cwd\n    }\n  );\n\n  watcher.on('change', async () => {\n    logger.log('📦  检测到配置文件变化,服务正在自动重启...');\n    await fkill(startProcess.pid);\n    startProcess = start(cli);\n  });\n};\n"],"file":"start.js"}